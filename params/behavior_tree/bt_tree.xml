<root BTCPP_format="4" main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <RecoveryNode number_of_retries="6" name="NavigateRecovery">

      <PipelineSequence name="NavigateWithReplanning">

        <ControllerSelector 
          selected_controller="{selected_controller}" 
          default_controller="dwb_controller" 
          topic_name="controller_selector" />

        <PlannerSelector 
          selected_planner="{selected_planner}" 
          default_planner="SmacPlannerHybrid" 
          topic_name="planner_selector" />

        <GoalCheckerSelector 
          selected_goal_checker="{selected_goal_checker}" 
          default_goal_checker="general_goal_checker"
          topic_name="goal_checker_selector" />

        <RateController hz="1.0">
          <RecoveryNode number_of_retries="1" name="ComputePathToPose">
            <ComputePathToPose 
              goal="{goal}" 
              path="{path}" 
              planner_id="{selected_planner}" />
            <Sequence>
              <WouldAPlannerRecoveryHelp error_code="0"/>
              <ClearEntireCostmap service_name="/global_costmap/clear_entirely_global_costmap"/>
            </Sequence>
          </RecoveryNode>
        </RateController>

        <RecoveryNode number_of_retries="1" name="FollowPath">
          <FollowPath 
            path="{path}" 
            controller_id="{selected_controller}" 
            goal_checker_id="{selected_goal_checker}" />
          <Sequence>
            <WouldAControllerRecoveryHelp error_code="0"/>
            <ClearEntireCostmap service_name="/local_costmap/clear_entirely_local_costmap"/>
          </Sequence>
        </RecoveryNode>

      </PipelineSequence>

      <ReactiveFallback name="RecoveryFallback">
        <GoalUpdated/>
        <SequenceWithMemory name="RecoveryActions">
          <ClearEntireCostmap service_name="/global_costmap/clear_entirely_global_costmap"/>
          <ClearEntireCostmap service_name="/local_costmap/clear_entirely_local_costmap"/>
          <Spin spin_dist="1.57" spin_speed="1.0" time_allowance="5.0"/>
          <Wait wait_duration="5"/>
          <BackUp backup_dist="0.30" backup_speed="0.15"/>
        </SequenceWithMemory>
      </ReactiveFallback>

    </RecoveryNode>
  </BehaviorTree>
</root>
